{
  "agent_id": "default",
  "version": 5,

  "models": "__POPULATED_AT_INIT__",
  "models_hash": "__COMPUTED_AT_INIT__",
  "_models_note": "This array is populated dynamically at first-init by discovering models from the agent's openclaw.json config. See model_discovery below for the classification heuristics.",

  "model_discovery": {
    "_note": "Rules used by the plugin at first-init to classify configured models into tiers. Not consumed at routing time — only used during seeding. IMPORTANT: All model refs must be normalized via parseModelRef() before matching. Heuristics match against canonical forms (e.g., 'anthropic/claude-opus-4-6', not 'anthropic/opus-4.6'). CLI detection uses isCliProvider(provider, cfg) which checks cliBackends config keys — not just the hardcoded prefixes below.",
    "tier_heuristics": {
      "fast": {
        "match": ["google/", "groq/", "cerebras/"],
        "indicators": ["gemini", "flash", "instant", "fast"],
        "default_capabilities": {
          "tools": false,
          "filesystem": false,
          "code_execution": false,
          "reasoning": "light"
        }
      },
      "mid": {
        "match": ["anthropic/claude-sonnet", "anthropic/claude-haiku", "openai/gpt-4", "mistral/"],
        "indicators": ["sonnet", "haiku", "4o", "medium"],
        "default_capabilities": {
          "tools": true,
          "filesystem": true,
          "code_execution": true,
          "reasoning": "standard"
        }
      },
      "heavy": {
        "match": ["anthropic/claude-opus", "claude-cli/", "openai/gpt-5", "openai-codex/"],
        "indicators": ["opus", "codex", "5.1", "o1", "o3"],
        "default_capabilities": {
          "tools": true,
          "filesystem": true,
          "code_execution": true,
          "reasoning": "deep"
        }
      }
    },
    "cli_provider_rule": "All CLI providers default to tier 'heavy' with full capabilities. Detection via isCliProvider(provider, cfg): checks 'claude-cli', 'codex-cli', AND all keys in agents.defaults.cliBackends. Do NOT rely on prefix matching alone — custom backends (e.g., 'my-cli') are only detectable via the config.",
    "unknown_model_rule": "Models that don't match any heuristic default to tier 'heavy'. Safe default — avoids capability downgrade on unknown models.",
    "user_override": "Users can manually edit the models array in the routing collection after init to reclassify or add models."
  },

  "classification": {
    "categories": {
      "CHAT": {
        "complexity_range": [1, 3],
        "description": "Greetings, opinions, casual conversation"
      },
      "QUICK": {
        "complexity_range": [1, 4],
        "description": "Translations, summaries, simple QA, lookups"
      },
      "TOOL": {
        "complexity_range": [5, 8],
        "description": "File ops, bash, tool invocations"
      },
      "CODE": {
        "complexity_range": [6, 9],
        "description": "Code gen, debug, refactor, multi-file edit"
      },
      "PLAN": {
        "complexity_range": [7, 10],
        "description": "Architecture, design, multi-step planning"
      }
    },
    "indicators": {
      "TOOL": [
        "exec",
        "bash",
        "git",
        "read file",
        "write file",
        "edit file",
        "run",
        "deploy",
        "install",
        "npm",
        "pnpm",
        "docker"
      ],
      "CODE": [
        "refactor",
        "debug",
        "implement",
        "fix bug",
        "add feature",
        "test",
        "```",
        "function",
        "class",
        "import",
        "type",
        "interface"
      ],
      "PLAN": [
        "plan",
        "architect",
        "design",
        "strategy",
        "roadmap",
        "how should we",
        "what approach",
        "RFC",
        "proposal"
      ],
      "CHAT": [
        "hello",
        "hi",
        "ciao",
        "come stai",
        "thanks",
        "grazie",
        "ok",
        "lol",
        "haha",
        "good morning",
        "buongiorno"
      ],
      "QUICK": [
        "translate",
        "traduci",
        "summarize",
        "riassumi",
        "what is",
        "cos'e",
        "define",
        "how many",
        "when",
        "who is",
        "chi e"
      ]
    },
    "path_patterns": [
      "/src/",
      "/test/",
      "/lib/",
      "/dist/",
      ".ts",
      ".js",
      ".py",
      ".go",
      ".rs",
      ".java",
      ".md",
      ".json",
      ".yaml",
      ".toml"
    ],
    "code_block_regex": "```[\\s\\S]*?```"
  },

  "routing": {
    "default_tier": "heavy",
    "ambiguous_action": "no_override",
    "capability_constraint": "Never select a model with fewer capabilities than the current agent context requires. If tools are active, only tool-capable models are eligible.",
    "rules": [
      { "if": "CHAT", "tools_in_context": false, "then": "fast", "priority": 1 },
      {
        "if": "CHAT",
        "tools_in_context": true,
        "then": "mid",
        "priority": 1,
        "reason": "tools active, minimum mid tier"
      },
      { "if": "QUICK", "tools_in_context": false, "then": "fast", "priority": 2 },
      {
        "if": "QUICK",
        "tools_in_context": true,
        "then": "mid",
        "priority": 2,
        "reason": "tools active, minimum mid tier"
      },
      { "if": "TOOL", "tools_in_context": true, "then": "heavy", "priority": 3 },
      {
        "if": "TOOL",
        "tools_in_context": false,
        "then": "heavy",
        "priority": 3,
        "reason": "tool intent without tools context, safe default"
      },
      { "if": "CODE", "tools_in_context": true, "then": "heavy", "priority": 4 },
      {
        "if": "CODE",
        "tools_in_context": false,
        "then": "heavy",
        "priority": 4,
        "reason": "code tasks need deep reasoning"
      },
      { "if": "PLAN", "tools_in_context": true, "then": "heavy", "priority": 5 },
      {
        "if": "PLAN",
        "tools_in_context": false,
        "then": "heavy",
        "priority": 5,
        "reason": "planning needs deep reasoning"
      }
    ]
  },

  "escalation": {
    "triggers": [
      "user explicitly requests a specific model",
      "previous response was insufficient (user re-asks or complains)",
      "prompt references files, code, or tools",
      "multi-turn context suggests increasing complexity"
    ],
    "de_escalation_triggers": [
      "conversation shifted to casual chat",
      "user asks simple follow-up after complex task"
    ]
  }
}
